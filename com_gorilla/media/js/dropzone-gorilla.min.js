var $j=jQuery.noConflict();$j(document).ready(function(){var e=function(){return JSON.parse($j("#dropzone-params").val())};var t=function(e){$j("#dropzone-params").val(JSON.stringify(e))};var n=function(){var t=e();var n=$j(t.fileListSelector).val();if(typeof n==="undefined"||n==""){n='{"files": []}'}return JSON.parse(n)};var r=function(t){var n=e();$j(n.fileListSelector).val(JSON.stringify(t))};var i=function(e,t,n,r){this.originalName=e;this.clientName=t;this.size=n;this.serverName=r};var s=function(e){var t=Math.floor(Math.random()*9999+1);return e.concat(t.toString())};var o=function(e){var t=s(e.name);var n=new i(e.name,t,e.upload.total,"");return n};var u=function(e){var t=n();t.files.push(e);r(t)};var a=function(e){var t=n();for(index=0;index<t.files.length;++index){if(t.files[index].clientName==e){return index}}return-1};var f=function(e){var t=n();for(index=0;index<t.files.length;++index){if(t.files[index].serverName==e){return index}}return-1};var l=function(e){var t=n();t.files.splice(e,1);r(t)};var c=e();var h=new Dropzone("div#dropzone-div",{url:c.addFileUrl,paramName:"file",maxFilesize:c.maxFilesize,clickable:true,uploadMultiple:c.uploadMultiple,maxFiles:c.maxFiles,addRemoveLinks:true,autoProcessQueue:true});h.on("maxfilesexceeded",function(e){this.removeFile(e)});h.on("sending",function(t,n,r){var i=e();var s=o(t);u(s);r.append("clientname",s.clientName);r.append(i.token,"1")});h.on("addedfile",function(e){});h.on("error",function(e,t){});h.on("canceled",function(e){var t=$j(e.previewTemplate).children(".dropzone-servername").val();var n=f(t);l(n)});h.on("success",function(e,t){var i=JSON.parse(t);var s=n();s.files[a(i.clientName)].serverName=i.serverName;r(s);$j(e.previewTemplate).append('<input type="hidden" class="dropzone-servername" value="'+i.serverName+'" />')});h.on("removedfile",function(t){var r=$j(t.previewTemplate).children(".dropzone-servername").val();var i=n();var s=f(r);l(s);var o=e();var u='"servername": "'+r+'", "'+o.token+'": "1"';var a=JSON.parse("{"+u+"}");$j.post(o.cancelFileUrl,a).done(function(e){}).fail(function(e){}).always(function(){})})})